XBOX.events=function(e,n,t){"use strict";var o={};return o.init=function(){var e=t(".xbox");o.on_change_colorpicker(e),o.on_change_code_editor(e),o.on_change_file(e),o.on_change_image_selector(e),o.on_change_number(e),o.on_change_oembed(e),o.on_change_radio(e),o.on_change_checkbox(e),o.on_change_switcher(e),o.on_change_select(e),o.on_change_text(e),o.on_change_textarea(e),o.on_change_wp_editor(e)},o.on_change_colorpicker=function(e){e.on("change",".xbox-type-colorpicker .xbox-element",function(){t(this).trigger("xbox_changed_value",t(this).val())})},o.on_change_code_editor=function(e){e.find(".xbox-code-editor").each(function(e,n){var o=ace.edit(t(n).attr("id"));o.getSession().on("change",function(e){t(n).trigger("xbox_changed_value",o.getValue())})})},o.on_change_file=function(e){e.on("change",".xbox-type-file .xbox-element",function(){t(this).trigger("xbox_changed_value",t(this).val())}),e.find(".xbox-type-file .xbox-field").on("xbox_after_add_files",function(e,n,o){var i;o.multiple?(i=[],t(n).each(function(e,n){i.push(n.url)})):t(n).each(function(e,n){i=n.url}),t(this).find(".xbox-element").trigger("xbox_changed_value",[i])})},o.on_change_image_selector=function(e){e.on("imgSelectorChanged",".xbox-type-image_selector .xbox-element",function(){if(t(this).closest(".xbox-image-selector").data("image-selector").like_checkbox){var e=[];t(this).closest(".xbox-radiochecks").find("input[type=checkbox]:checked").each(function(n,o){e.push(t(this).val())}),t(this).trigger("xbox_changed_value",[e])}else t(this).trigger("xbox_changed_value",t(this).val())})},o.on_change_number=function(e){e.on("input",".xbox-type-number .xbox-element",function(){t(this).trigger("xbox_changed_value",parseInt(t(this).val(),10))}),e.find(".xbox-type-number .xbox-field").spinner("changing",function(e,n,o){t(this).trigger("xbox_changed_value",n)})},o.on_change_oembed=function(e){e.on("change",".xbox-type-oembed .xbox-element",function(){t(this).trigger("xbox_changed_value",t(this).val())})},o.on_change_radio=function(e){e.on("ifChecked",".xbox-type-radio .xbox-element",function(){t(this).trigger("xbox_changed_value",t(this).val())})},o.on_change_checkbox=function(e){e.on("ifChanged",".xbox-type-checkbox .xbox-element",function(){var e=[];t(this).closest(".xbox-radiochecks").find("input[type=checkbox]:checked").each(function(n,o){e.push(t(this).val())}),t(this).trigger("xbox_changed_value",[e])})},o.on_change_switcher=function(e){e.on("statusChange",".xbox-type-switcher .xbox-element",function(){t(this).trigger("xbox_changed_value",t(this).val())})},o.on_change_select=function(e){e.find(".xbox-type-select .xbox-element").dropdown({onChange:function(e,n,t){t.closest(".xbox-element").trigger("xbox_changed_value",e)}})},o.on_change_text=function(e){e.on("input",".xbox-type-text .xbox-element",function(){t(this).trigger("xbox_changed_value",t(this).val())})},o.on_change_textarea=function(e){e.on("input",".xbox-type-textarea .xbox-element",function(){t(this).trigger("xbox_changed_value",t(this).val())})},o.on_change_wp_editor=function(e){var n=e.find(".xbox-type-wp_editor textarea.wp-editor-area");e.on("input",".xbox-type-wp_editor textarea.wp-editor-area",function(){t(this).trigger("xbox_changed_value",t(this).val())}),setTimeout(function(){n.each(function(e,n){var o=t(n).attr("id"),i=tinymce.get(o);i&&i.on("change input",function(e){i.getContent();t(n).trigger("xbox_changed_value",i.getContent())})})},1e3)},t(function(){o.init()}),o}(window,document,jQuery);
window.XBOX=function(e,t,o){"use strict";function i(e){return void 0===e||e===!1||0===o.trim(e).length}function r(e,t){if(t=t||",","checkbox"!=e.attr("type"))return"";var o=e.filter(":checked").map(function(){return this.value}).get().join(t);return o}function n(){var o=e,i="inner";return"innerWidth"in e||(i="client",o=t.documentElement||t.body),{width:o[i+"Width"],height:o[i+"Height"]}}var a={duplicate:!1,media:{frames:{}}};return a.init=function(){var t=o(".xbox");o(e).resize(function(){n().width<=850?o("#post-body").addClass("xbox-columns-1"):o("#post-body").removeClass("xbox-columns-1")}).resize(),a.init_switcher(),a.init_spinner(),a.init_tab(),a.init_tooltip(),a.init_checkbox(),a.init_image_selector(),a.init_dropdown(),a.init_colorpicker(),a.init_code_editor(),a.init_sortable_preview_items(),a.init_sortable_repeatable_items(),a.init_sortable_group_items(),a.load_oembeds(),t.on("click","#xbox-reset",a.on_click_reset_values),t.on("click","#xbox-import",a.on_click_import_values),t.on("ifClicked",".xbox-type-import .xbox-radiochecks input",a.toggle_import),t.on("click",".xbox-type-import .xbox-radiochecks input",a.toggle_import),t.on("click",".xbox-add-group-item",a.new_group_item),t.on("click",".xbox-duplicate-group-item",a.new_group_item),t.on("click",".xbox-remove-group-item",a.remove_group_item),t.on("click",".xbox-group-control-item",a.on_click_group_control_item),t.on("sort_group_items",".xbox-group-wrap",a.sort_group_items),t.on("sort_group_control_items",".xbox-group-control",a.sort_group_control_items),t.on("click",".xbox-add-repeatable-item",a.add_repeatable_item),t.on("click",".xbox-remove-repeatable-item",a.remove_repeatable_item),t.on("sort_repeatable_items",".xbox-repeatable-wrap",a.sort_repeatable_items),t.on("click",".xbox-upload-file, .xbox-preview-item .xbox-preview-handler",a.wp_media_upload),t.on("click",".xbox-remove-preview",a.remove_preview_item),t.on("click",".xbox-get-oembed",a.get_oembed),t.on("click",".xbox-get-image",a.get_image_from_url),t.on("focusout",".xbox-type-colorpicker input",a.on_focusout_input_colorpicker),t.on("change",".xbox-type-textarea textarea.xbox-element",a.on_change_textarea),t.on("click",".xbox-section.xbox-toggle-1 .xbox-section-header, .xbox-section .xbox-toggle-icon",a.toggle_section)},a.toggle_section=function(e){e.stopPropagation();var t=o(this),i=t.closest(".xbox-section.xbox-toggle-1"),r=i.find(".xbox-section-body"),n=i.data("toggle"),a=i.find(".xbox-toggle-icon").first();if(!t.hasClass("xbox-section-header")||"icon"!=n.target){var c={duration:parseInt(n.speed),complete:function(){"block"==r.css("display")?a.find("i").removeClass(n.close_icon).addClass(n.open_icon):a.find("i").removeClass(n.open_icon).addClass(n.close_icon)}};return"slide"==n.effect?r.slideToggle(c):"fade"==n.effect&&r.fadeToggle(c),!1}},a.toggle_import=function(e){var t=o(this),i=o(".xbox-wrap-input-file"),r=o(".xbox-wrap-input-url");(t.next("img").length||"from_file"!=t.val()&&"from_url"!=t.val())&&(i.hide(),r.hide()),"from_file"==t.val()&&(i.show(),r.hide()),"from_url"==t.val()&&(r.show(),i.hide())},a.on_change_textarea=function(e){o(this).text(o(this).val())},a.on_click_reset_values=function(e){var t=o(this),i=t.closest(".xbox-form");return o.xboxConfirm({title:XBOX_JS.text.reset_popup.title,content:XBOX_JS.text.reset_popup.content,confirm_class:"xbox-btn-blue",confirm_text:XBOX_JS.text.popup.accept_button,cancel_text:XBOX_JS.text.popup.cancel_button,onConfirm:function(){i.prepend('<input type="hidden" name="'+t.attr("name")+'" value="true">'),i.submit()},onCancel:function(){return!1}}),!1},a.on_click_import_values=function(e){var t=o(this),i=t.closest(".xbox-form");return i.length||(i=t.closest("form#post")),o.xboxConfirm({title:XBOX_JS.text.import_popup.title,content:XBOX_JS.text.import_popup.content,confirm_class:"xbox-btn-blue",confirm_text:XBOX_JS.text.popup.accept_button,cancel_text:XBOX_JS.text.popup.cancel_button,onConfirm:function(){i.prepend('<input type="hidden" name="'+t.attr("name")+'" value="true">'),i.submit()},onCancel:function(){return!1}}),!1},a.get_image_from_url=function(e){var t=o(this),r=t.closest(".xbox-field"),n=r.find(".xbox-element-text"),a=r.find(".xbox-wrap-preview");if(i(n.val()))return o.xboxConfirm({title:XBOX_JS.text.validation_url_popup.title,content:XBOX_JS.text.validation_url_popup.content,confirm_text:XBOX_JS.text.popup.accept_button,hide_cancel:!0}),!1;var c=a.data("image-class"),l=o("<li />",{class:"xbox-preview-item xbox-preview-image"});return l.html('<img src="'+n.val()+'" class="'+c+'"><a class="xbox-btn xbox-btn-iconize xbox-btn-small xbox-btn-red xbox-remove-preview"><i class="xbox-icon xbox-icon-times-circle"></i></a>'),a.fadeOut(400,function(){o(this).html("").show()}),r.find(".xbox-get-image i").addClass("xbox-icon-spin"),setTimeout(function(){a.html(l),r.find(".xbox-get-image i").removeClass("xbox-icon-spin")},1200),!1},a.load_oembeds=function(e){o(".xbox-type-oembed").each(function(e,t){o(t).find(".xbox-wrap-oembed").data("preview-onload")&&a.get_oembed(o(t).find(".xbox-get-oembed"))})},a.get_oembed=function(e){var t;t=o(e.currentTarget).length?o(e.currentTarget):e;var r=t.closest(".xbox-field"),n=r.find(".xbox-element-text"),a=r.find(".xbox-wrap-preview");return i(n.val())&&o(e.currentTarget).length?(o.xboxConfirm({title:XBOX_JS.text.validation_url_popup.title,content:XBOX_JS.text.validation_url_popup.content,confirm_text:XBOX_JS.text.popup.accept_button,hide_cancel:!0}),!1):(o.ajax({type:"post",dataType:"json",url:XBOX_JS.ajax_url,data:{action:"xbox_get_oembed",oembed_url:n.val(),preview_size:a.data("preview-size"),ajax_nonce:XBOX_JS.ajax_nonce},beforeSend:function(){a.fadeOut(400,function(){o(this).html("").show()}),r.find(".xbox-get-oembed i").addClass("xbox-icon-spin")},success:function(e){if(e)if(e.success){var t=o("<li />",{class:"xbox-preview-item xbox-preview-oembed"});t.html('<div class="xbox-oembed xbox-oembed-provider-'+e.provider+' xbox-element-oembed ">'+e.oembed+'<a class="xbox-btn xbox-btn-iconize xbox-btn-small xbox-btn-red xbox-remove-preview"><i class="xbox-icon xbox-icon-times-circle"></i></a></div>'),a.html(t)}else a.html(e.message)},error:function(e,t,o){},complete:function(e,t){r.find(".xbox-get-oembed i").removeClass("xbox-icon-spin")}}),!1)},a.wp_media_upload=function(e){if(void 0!==wp){var t=o(this),i=a.media;if(i.$field=t.closest(".xbox-field"),i.field_id=i.$field.closest(".xbox-row").data("field-id"),i.frame_id=i.$field.closest(".xbox").attr("id")+"_"+i.field_id,i.$upload_btn=i.$field.find(".xbox-upload-file"),i.$wrap_preview=i.$field.find(".xbox-wrap-preview"),i.multiple=i.$field.hasClass("xbox-has-multiple"),i.$preview_item=void 0,i.attachment_id=void 0,t.closest(".xbox-preview-item").length?i.$preview_item=t.closest(".xbox-preview-item"):i.multiple||(i.$preview_item=i.$field.find(".xbox-preview-item").first()),i.$preview_item&&(i.attachment_id=i.$preview_item.find(".xbox-attachment-id").val()),void 0!==i.frames[i.frame_id])return void i.frames[i.frame_id].open();i.frames[i.frame_id]=wp.media({title:i.$field.closest(".xbox-type-file").find(".xbox-element-label").first().text(),multiple:!!i.multiple&&"add"}),i.frames[i.frame_id].on("open",a.on_open_wp_media).on("select",a.on_select_wp_media),i.frames[i.frame_id].open()}},a.on_open_wp_media=function(e){var t=a.media,o=a.media.frames[t.frame_id].state().get("selection");if(i(t.attachment_id))return o.reset();var r=wp.media.attachment(t.attachment_id);r.fetch(),o.set(r?[r]:[])},a.on_select_wp_media=function(e){var t=a.media,i=t.frames[t.frame_id].state().get("selection").toJSON(),r=t.$wrap_preview.data("preview-size"),n=t.$wrap_preview.data("field-name"),c=t.$field.closest(".xbox-type-group").find(".xbox-group-control").data("image-field-id");t.$field.trigger("xbox_before_add_files",[i,a.media]),o(i).each(function(e,i){var l="",x="",s=o("<li />",{class:"xbox-preview-item xbox-preview-file"});"image"==i.type?(s.addClass("xbox-preview-image"),x='<img src="'+i.url+'" style="width: '+r.width+"; height: "+r.height+'" data-full-img="'+i.url+'" class="xbox-image xbox-preview-handler">'):x='<img src="'+i.icon+'" class="xbox-preview-icon-file xbox-preview-handler"><a href="'+i.url+'" class="xbox-preview-download-link">'+i.filename+'</a><span class="xbox-preview-mime xbox-preview-handler">'+i.mime+"</span>",t.multiple&&(l='<input type="hidden" name="'+t.$upload_btn.data("field-name")+'" value="'+i.url+'" class="xbox-element xbox-element-hidden">'),l+='<input type="hidden" name="'+n+'" value="'+i.id+'" class="xbox-attachment-id">',s.html(l+x+'<a class="xbox-btn xbox-btn-iconize xbox-btn-small xbox-btn-red xbox-remove-preview"><i class="xbox-icon xbox-icon-times-circle"></i></a>'),t.multiple?t.$preview_item?t.attachment_id!=i.id&&t.$preview_item.after(s):t.$wrap_preview.append(s):(t.$wrap_preview.html(s),t.$field.find(".xbox-element").attr("value",i.url),"image"==i.type&&(t.field_id==c&&a.synchronize_selector_preview_image(".xbox-control-image",t.$wrap_preview,"add",i.url),a.synchronize_selector_preview_image("",t.$wrap_preview,"add",i.url)))}),t.$field.trigger("xbox_after_add_files",[i,t])},a.remove_preview_item=function(e){var t=o(this),i=t.closest(".xbox-field"),r=i.closest(".xbox-row").data("field-id"),n=i.closest(".xbox-type-group").find(".xbox-group-control").data("image-field-id"),c=i.find(".xbox-wrap-preview"),l=i.hasClass("xbox-has-multiple");return i.trigger("xbox_before_remove_preview_item",[l]),l||i.find(".xbox-element").attr("value",""),t.closest(".xbox-preview-item").remove(),!l&&t.closest(".xbox-preview-item").hasClass("xbox-preview-image")&&(r==n&&a.synchronize_selector_preview_image(".xbox-control-image",c,"remove",""),a.synchronize_selector_preview_image("",c,"remove","")),i.trigger("xbox_after_remove_preview_item",[l]),!1},a.synchronize_selector_preview_image=function(e,t,r,n){e=e||t.data("synchronize-selector"),i(e)||(e=e.split(","),o.each(e,function(e,t){var i=o(t);i.closest(".xbox-type-group").length&&(i=i.closest(".xbox-group-control").length?i.closest(".xbox-group-control-item.xbox-active").find(t):i.closest(".xbox-group-item.xbox-active").find(t)),i.is("img")?i.fadeOut(300,function(){i.closest(".xbox-group-control").length?i.attr("src",n):i.attr("src",n)}):i.fadeOut(300,function(){i.closest(".xbox-group-control").length?i.css("background-image","url("+n+")"):i.css("background-image","url("+n+")")}),"add"==r&&i.fadeIn(300);var a=i.closest(".xbox-field").find("input.xbox-element");a.length&&a.attr("value",n);var c=i.closest(".xbox-preview-item").find(".xbox-remove-preview");c.length&&("add"==r&&a.is(":visible")&&c.show(),"remove"==r&&c.hide())}))},a.reinit_js_plugins=function(e,t){e.find(".xbox-tab").each(function(e,t){a.init_tab(o(t))}),e.find(".xbox-type-switcher input.xbox-element").each(function(e,t){o(t).xboxSwitcher("destroy"),a.init_switcher(o(t))}),e.find(".xbox-type-number .xbox-field").each(function(e,t){a.init_spinner(o(t))}),e.find(".xbox-has-icheck .xbox-radiochecks.init-icheck").each(function(e,t){a.destroy_icheck(o(t)),a.init_checkbox(o(t))}),e.find(".xbox-colorpicker-color").each(function(e,t){a.init_colorpicker(o(t))}),e.find(".ui.selection.dropdown").each(function(e,t){a.init_dropdown(o(t))}),e.find(".xbox-group-control.xbox-sortable").each(function(e,t){a.init_sortable_group_items(o(t))}),e.find(".xbox-repeatable-wrap.xbox-sortable").each(function(e,t){a.init_sortable_repeatable_items(o(t))}),e.find(".xbox-wrap-preview-multiple").each(function(e,t){a.init_sortable_preview_items(o(t))}),e.find(".xbox-code-editor").each(function(e,t){a.destroy_ace_editor(o(t)),a.init_code_editor(o(t))}),a.init_tooltip(e.find(".xbox-tooltip-handler"))},a.destroy_wp_editor=function(e){"undefined"!=typeof tinyMCEPreInit&&"undefined"!=typeof tinymce&&"undefined"!=typeof QTags&&(e.find(".quicktags-toolbar, .mce-tinymce.mce-container").remove(),tinymce.execCommand("mceRemoveEditor",!0,e.find(".wp-editor-area").attr("id")),e.addClass("init-wp-editor"))},a.on_change_wp_editor=function(e){if("undefined"!=typeof tinymce){var t=o(e.settings.selector);e.on("change mouseleave input",function(e){var o=tinymce.get(t.attr("id")).getContent();t.text(o).val(o)})}},a.init_wp_editor=function(e){if("undefined"!=typeof tinyMCEPreInit&&"undefined"!=typeof tinymce&&"undefined"!=typeof QTags){e.removeClass("init-wp-editor"),e.removeClass("html-active").addClass("tmce-active");var t=e.find(".wp-editor-area"),o=t.attr("id"),i=e.closest(".xbox-group-wrap").find(".xbox-group-item").eq(0).find(".wp-editor-area").first().attr("id");t.show();var r=jQuery.extend({},tinyMCEPreInit.mceInit[i]);r.body_class=o,r.selector="#"+o,r.mode="tmce",tinyMCEPreInit.mceInit[o]=r,tinymce.init(tinyMCEPreInit.mceInit[o]);var n=jQuery.extend({},tinyMCEPreInit.qtInit[i]);n.id=o,new QTags(o),QTags._buttonsInit()}},a.init_switcher=function(e){e=i(e)?o(".xbox-type-switcher input.xbox-element"):e,e.xboxSwitcher()},a.init_spinner=function(e){e=i(e)?o(".xbox-type-number .xbox-field"):e,e.spinner("delay",300)},a.init_tab=function(e){e=i(e)?o(".xbox-tab"):e,e.find(".xbox-tab-nav .xbox-item").removeClass("active"),e.find(".xbox-accordion-title").removeClass("active");var t="responsive";e.closest("#side-sortables").length&&(t="accordion"),e.xboxTabs({collapsible:!0,type:t})},a.init_tooltip=function(e){e=i(e)?o(".xbox-tooltip-handler"):e,e.each(function(e,t){var r="",n=o(t).data("tipso-title"),a="left";i(n)||(r="<h3>"+n+"</h3>"),o(t).tipso({delay:10,speed:100,offsetY:2,position:a,titleContent:r,onBeforeShow:function(e,i,r){o(r.tipso_bubble).addClass(o(t).closest(".xbox").data("skin"))},onShow:function(e,t,o){}})})},a.init_checkbox=function(e){e=i(e)?o(".xbox-has-icheck .xbox-radiochecks.init-icheck"):e,e.find("input").iCheck({radioClass:"iradio_flat-blue",checkboxClass:"icheckbox_flat-blue"})},a.destroy_icheck=function(e){e.find("input").each(function(e,t){o(t).attr("style",""),o(t).next("ins").remove(),o(t).unwrap()})},a.init_image_selector=function(e){e=i(e)?o(".xbox-type-image_selector .init-image-selector, .xbox-type-import .init-image-selector"):e,e.xboxImageSelector({active_class:"xbox-active"})},a.init_dropdown=function(e){e=i(e)?o(".ui.selection.dropdown"):e,e.each(function(e,t){var i=parseInt(o(t).data("max-selections")),r=o(t).find('input[type="hidden"]').val();i>1&&o(t).hasClass("multiple")?(o(t).dropdown({maxSelections:i}),o(t).dropdown("set selected",r.split(","))):o(t).dropdown()})},a.on_focusout_input_colorpicker=function(e){var t=o(this).val();return o(this).attr("value",t),o(this).next().find(".xbox-colorpicker-color").attr("value",t).css("background-color",t),!1},a.init_colorpicker=function(e){e=i(e)?o(".xbox-colorpicker-color"):e,e.colorPicker({cssAddon:".cp-color-picker {margin-top:6px;}",buildCallback:function(e){},renderCallback:function(e,t){var o=e.closest(".xbox-field");this.$UI.find(".cp-alpha").toggle(o.hasClass("xbox-has-alpha"));var i=this.color.toString("rgb",!0);o.hasClass("xbox-has-alpha")||(i="#"+this.color.colors.HEX),i=i.indexOf("NAN")>-1?"":i,o.find("input").attr("value",i),o.find(".xbox-colorpicker-color").attr("value",i).css("background-color",i),o.find("input").trigger("change")}})},a.destroy_ace_editor=function(e){var t=e.closest(".xbox-field").find("textarea.xbox-element");e.text(t.val())},a.init_code_editor=function(e){e=i(e)?o(".xbox-code-editor"):e,e.each(function(e,t){var i=ace.edit(o(t).attr("id")),r=o(t).data("language"),n=o(t).data("theme");i.setTheme("ace/theme/"+n),i.getSession().setMode("ace/mode/"+r),i.setFontSize(15),i.setShowPrintMargin(!1),i.getSession().on("change",function(e){o(t).closest(".xbox-field").find("textarea.xbox-element").text(i.getValue())}),ace.config.loadModule("ace/ext/language_tools",function(){i.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0})})})},a.init_sortable_preview_items=function(e){e=i(e)?o(".xbox-wrap-preview-multiple"):e,e.sortable({items:".xbox-preview-item",placeholder:"xbox-preview-item xbox-sortable-placeholder",start:function(e,t){t.placeholder.css({width:t.item.css("width"),height:t.item.css("height")})}}).disableSelection()},a.init_sortable_repeatable_items=function(e){e=i(e)?o(".xbox-repeatable-wrap.xbox-sortable"):e,e.sortable({handle:".xbox-sort-item",items:".xbox-repeatable-item",placeholder:"xbox-repeatable-item xbox-sortable-placeholder",start:function(e,t){t.placeholder.css({width:t.item.css("width"),height:t.item.css("height")})},update:function(e,t){},stop:function(e,t){var i=o(e.target);i.trigger("sort_repeatable_items")}}).disableSelection()},a.init_sortable_group_items=function(e){e=i(e)?o(".xbox-group-control.xbox-sortable"):e,e.sortable({items:".xbox-group-control-item",placeholder:"xbox-sortable-placeholder",start:function(e,t){t.placeholder.css({width:t.item.css("width"),height:t.item.css("height")})},update:function(e,t){var i,r=o(e.target),n=r.next(".xbox-group-wrap"),a=t.item.attr("data-index"),c=r.find(".xbox-group-control-item").index(t.item),l=n.children(".xbox-group-item[data-index="+a+"]"),x=n.children(".xbox-group-item[data-index="+c+"]"),s=0;a<c?(l.insertAfter(x),s=a,i=c):(l.insertBefore(x),s=c,i=a),r.trigger("sort_group_control_items"),n.trigger("sort_group_items",[s,i]),t.item.hasClass("xbox-active")&&t.item.trigger("click")}}).disableSelection()},a.add_repeatable_item=function(e){var t=o(this),i=t.closest(".xbox-repeatable-wrap");i.trigger("xbox_before_add_repeatable_item");var r=t.prev(".xbox-repeatable-item"),n=parseInt(r.data("index")),c=r.clone(),l=o("<div />",{class:c.attr("class"),"data-index":n+1,style:"display: none"});return a.set_changed_values(c,i.closest(".xbox-row").data("field-type")),l.html(c.html()),r.after(l),l.slideDown(150,function(){i.trigger("sort_repeatable_items"),a.reinit_js_plugins(l,r)}),i.trigger("xbox_after_add_repeatable_item"),!1},a.remove_repeatable_item=function(e){var t=o(this).closest(".xbox-repeatable-wrap");if(t.find(".xbox-repeatable-item").length>1){t.trigger("xbox_before_remove_repeatable_item");var i=o(this).closest(".xbox-repeatable-item");i.slideUp(150,function(){i.remove(),t.trigger("sort_repeatable_items"),t.trigger("xbox_after_remove_repeatable_item")})}return!1},a.sort_repeatable_items=function(e){var t=o(e.target),i=parseInt(t.closest('[class*="xbox-row"]').data("row-level"));t.find(".xbox-repeatable-item").each(function(e,t){a.update_attributes(o(t),e,i),o(t).find(".wp-editor-wrap").each(function(e,t){a.destroy_wp_editor(o(t))}),a.update_fields_on_item_active(o(t))})},a.new_group_item=function(e){o(e.currentTarget).hasClass("xbox-duplicate-group-item")?a.duplicate=!0:a.duplicate=!1;var t=o(this).closest(".xbox-type-group").first();return t.trigger("xbox_before_add_group_item",[o(this),a.duplicate]),a.add_group_control_item(o(this)),a.add_group_item(o(this)),t.trigger("xbox_after_add_group_item",[o(this),a.duplicate]),!1},a.add_group_control_item=function(e){var t=e.closest(".xbox-type-group").find(".xbox-group-control").first(),i=t.find(".xbox-group-control-item").last();if(a.duplicate){var r=e.closest(".xbox-group-control-item").index();i=t.children(".xbox-group-control-item").eq(r)}var n=parseInt(i.data("index")),c=(parseInt(i.closest(".xbox-row").data("row-level")),i.clone()),l=o("<li />",{class:c.attr("class"),"data-index":n+1});if(l.html(c.html()),i.after(l),l=i.next(".xbox-group-control-item"),t.trigger("sort_group_control_items"),a.duplicate===!1&&l.find(".xbox-control-image").length&&l.find(".xbox-control-image").css("background-image","url()"),a.duplicate===!1){var x=l.find(".xbox-inner input");if(x.length){var s=t.data("control-name").toString();x.attr("value",s.replace(/(#\d?)/g,"#"+(n+2))),e.hasClass("xbox-custom-add")&&x.attr("value",e.text())}}},a.add_group_item=function(e){var t=e.closest(".xbox-type-group").find(".xbox-group-wrap").first(),i=t.children(".xbox-group-item").last();if(a.duplicate){var r=e.closest(".xbox-group-control-item").index();i=t.children(".xbox-group-item").eq(r)}var n=parseInt(i.data("index")),c=parseInt(i.closest(".xbox-row").data("row-level")),l=i.clone(),x=a.cook_group_item(l,c,n),s=o("<div />",{class:l.attr("class"),"data-index":n+1});s.html(x.html()),i.after(s),s=i.next(".xbox-group-item"),t.trigger("sort_group_items",[n+1]),a.reinit_js_plugins(s,i),a.duplicate===!1&&a.set_default_values(s,c);var d=e.closest(".xbox-type-group").find(".xbox-group-control").first();return d.children(".xbox-group-control-item").eq(n+1).trigger("click"),!1},a.cook_group_item=function(e,t,i){var r=i+1;return a.duplicate?a.set_changed_values(e):(e.find(".xbox-group-wrap").each(function(e,t){o(t).find(".xbox-group-item").first().addClass("xbox-active").siblings().remove(),o(t).prev(".xbox-group-control").children(".xbox-group-control-item").first().addClass("xbox-active").siblings().remove()}),e.find(".xbox-repeatable-wrap").each(function(e,t){o(t).find(".xbox-repeatable-item").not(":first").remove()})),a.update_attributes(e,r,t),e},a.set_changed_values=function(e,t){var i;e.find(".xbox-field").each(function(e,r){var n=t||o(r).closest(".xbox-row").data("field-type");switch(n){case"text":case"number":case"oembed":case"file":case"image":i=o(r).find("input.xbox-element"),i.attr("value",i.val())}})},a.remove_group_item=function(e){e.preventDefault();var t=o(this);return o.xboxConfirm({title:XBOX_JS.text.remove_item_popup.title,content:XBOX_JS.text.remove_item_popup.content,confirm_class:"xbox-btn-blue",confirm_text:XBOX_JS.text.popup.accept_button,cancel_text:XBOX_JS.text.popup.cancel_button,onConfirm:function(){setTimeout(function(){a.remove_group_control_item(t),a._remove_group_item(t)},150)}}),!1},a.remove_group_control_item=function(e){var t=e.closest(".xbox-group-control");if(t.children(".xbox-group-control-item").length>1){var o=e.closest(".xbox-group-control-item");o.fadeOut(200,function(){o.remove(),t.trigger("sort_group_control_items")})}},a._remove_group_item=function(e){var t=e.closest(".xbox-type-group"),o=t.find(".xbox-group-wrap").first(),i=e.closest(".xbox-group-control"),r=e.closest(".xbox-group-control-item").index();if(o.children(".xbox-group-item").length>1){t.trigger("xbox_before_remove_group_item");var n=o.children(".xbox-group-item").eq(r);n.fadeOut(200,function(){n.remove(),o.trigger("sort_group_items",[r]),i.children(".xbox-group-control-item").eq(0).trigger("click"),t.trigger("xbox_after_remove_group_item")})}},a.on_click_group_control_item=function(e){var t=o(this),i=t.parent(),r=t.index(),n=i.closest(".xbox-type-group").find(".xbox-group-wrap").first(),c=n.children(".xbox-group-item").eq(r);return i.children(".xbox-group-control-item").removeClass("xbox-active"),t.addClass("xbox-active"),n.children(".xbox-group-item").removeClass("xbox-active"),c.addClass("xbox-active"),a.update_fields_on_item_active(c),!1},a.update_fields_on_item_active=function(e){e.find(".wp-editor-wrap.init-wp-editor").each(function(e,t){a.init_wp_editor(o(t))})},a.sort_group_control_items=function(e){var t=o(e.target),i=parseInt(t.closest(".xbox-row").data("row-level"));t.children(".xbox-group-control-item").each(function(e,t){a.update_group_control_item(o(t),e,i)})},a.sort_group_items=function(e,t,i){var r=o(e.target);r.trigger("xbox_before_sort_group");var n=parseInt(r.closest(".xbox-row").data("row-level"));i=void 0!==i?parseInt(i)+1:void 0;var c=r.children(".xbox-group-item"),l=c.slice(t,i);l.each(function(e,t){var i=r.find(o(t)).index();a.update_attributes(o(t),i,n),o(t).find(".wp-editor-wrap").each(function(e,t){a.destroy_wp_editor(o(t))})}),r.trigger("xbox_after_sort_group")},a.update_group_control_item=function(e,t,i){e.data("index",t).attr("data-index",t),e.find(".xbox-info-order-item").text("#"+(t+1));var r;e.find(".xbox-inner input").length&&(r=e.find(".xbox-inner input").val(),e.find(".xbox-inner input").val(r.replace(/(#\d+)/g,"#"+(t+1)))),e.find("*[name]").each(function(e,r){a.update_name_ttribute(o(r),t,i)})},a.update_attributes=function(e,t,i){e.data("index",t).attr("data-index",t),e.find("*[name]").each(function(e,r){a.update_name_ttribute(o(r),t,i)}),e.find("*[id]").each(function(e,r){a.update_id_attribute(o(r),t,i)}),e.find("label[for]").each(function(e,r){a.update_for_attribute(o(r),t,i)}),e.find("*[data-field-name]").each(function(e,r){a.update_data_name_attribute(o(r),t,i)}),e.find("*[data-editor]").each(function(e,r){a.update_data_editor_attribute(o(r),t,i)}),e.find("*[data-wp-editor-id]").each(function(e,r){a.update_data_wp_editor_id_attribute(o(r),t,i)}),a.set_checked_inputs(e,i)},a.set_checked_inputs=function(e,t){e.find(".xbox-field").each(function(e,t){if(o(t).hasClass("xbox-has-icheck")||o(t).closest(".xbox-type-image_selector").length){var i=o(t).find('input[type="radio"], input[type="checkbox"]');i.each(function(e,t){o(t).parent("div").hasClass("checked")?o(t).attr("checked","checked").prop("checked",!0):o(t).removeAttr("checked").prop("checked",!1),o(t).next("img").hasClass("xbox-active")&&o(t).attr("checked","checked").prop("checked",!0)})}})},a.update_name_ttribute=function(e,t,o){var i=e.attr("name"),r="";"undefined"!=typeof i&&(r=a.nice_replace(/(\[\d+\])/g,i,"["+t+"]",o),e.attr("name",r))},a.update_id_attribute=function(e,t,o){var i=e.attr("id"),r="";"undefined"!=typeof i&&(r=a.nice_replace(/(__\d+__)/g,i,"__"+t+"__",o),e.attr("id",r))},a.update_for_attribute=function(e,t,o){var i=e.attr("for"),r="";"undefined"!=typeof i&&(r=a.nice_replace(/(__\d+__)/g,i,"__"+t+"__",o),e.attr("for",r))},a.update_data_name_attribute=function(e,t,o){var i=e.attr("data-field-name"),r="";"undefined"!=typeof i&&(r=a.nice_replace(/(\[\d+\])/g,i,"["+t+"]",o),e.attr("data-field-name",r))},a.update_data_editor_attribute=function(e,t,o){var i=e.attr("data-editor"),r="";"undefined"!=typeof i&&(r=a.nice_replace(/(__\d+__)/g,i,"__"+t+"__",o),e.attr("data-editor",r))},a.update_data_wp_editor_id_attribute=function(e,t,o){var i=e.attr("data-wp-editor-id"),r="";"undefined"!=typeof i&&(r=a.nice_replace(/(__\d+__)/g,i,"__"+t+"__",o),e.attr("data-wp-editor-id",r))},a.set_default_values=function(e,t){var n,a;e.find("*[data-default]").each(function(e,t){var c=o(t),l=c.data("default"),x=l.toString().toLowerCase();if(c.closest(".xbox-type-text").length||c.closest(".xbox-type-number").length||c.closest(".xbox-type-colorpicker").length)c.find("input.xbox-element").attr("value",l),c.closest(".xbox-type-colorpicker").length&&c.find(".xbox-colorpicker-color").attr("value",l).css("background-color",l);else if(c.hasClass("xbox-has-icheck")&&c.find(".init-icheck").length)if(n=c.find("input"),c.closest(".xbox-type-radio").length){if(i(n.filter(":checked").val()))return;n.filter(":checked").val().toLowerCase()!=x&&n.filter(function(e){return o(this).val().toLowerCase()==x}).iCheck("check")}else r(n,",").toLowerCase()!=x&&(n.iCheck("uncheck"),a=x.replace(/ /g,"").split(","),o.each(a,function(e){n.filter(function(t){return o(this).val().toLowerCase()==a[e]}).iCheck("check")}));else if(c.closest(".xbox-type-file").length||c.closest(".xbox-type-oembed").length)c.find('input[type="text"]').attr("value",l),c.find(".xbox-wrap-preview").html("");else if(c.closest(".xbox-type-image").length)c.find("input.xbox-element").attr("value",l),c.find("img.xbox-element-image").attr("src",l),i(l)&&c.find("img.xbox-element-image").hide().next(".xbox-remove-preview").hide();else if(c.closest(".xbox-type-image_selector").length){n=c.find("input");var s=n.closest(".xbox-image-selector").data("image-selector");if(s.like_checkbox)r(n,",").toLowerCase()!=x&&(n.first().trigger("img_selector_disable_all"),a=x.replace(/ /g,"").split(","),o.each(a,function(e){n.filter(function(t){return o(this).val().toLowerCase()==a[e]}).trigger("click.img_selector")}));else{if(i(n.filter(":checked").val()))return;n.filter(":checked").val().toLowerCase()!=x&&n.filter(function(e){return o(this).val().toLowerCase()==x}).trigger("click.img_selector")}}else if(c.closest(".xbox-type-select").length){var d=c.find(".ui.selection.dropdown"),p=parseInt(d.data("max-selections"));d.dropdown("clear"),p>1&&d.hasClass("multiple")?d.dropdown("set selected",l.split(",")):d.dropdown("set selected",l)}else c.closest(".xbox-type-switcher").length&&(n=c.find("input"),n.val()!==l&&(n.next().hasClass("xbox-sw-on")?n.xboxSwitcher("set_off"):n.xboxSwitcher("set_on")));if(c.closest(".xbox-type-wp_editor").length&&c.find("textarea").val(l),c.closest(".xbox-type-textarea").length&&c.find("textarea").text(l),c.closest(".xbox-type-code_editor").length){c.find("textarea.xbox-element").text(l);var u=ace.edit(c.find(".xbox-code-editor").attr("id"));u.setValue(l)}})},a.nice_replace=function(e,t,o,i,r){r=r||0;var n=0;return t=t.replace(e,function(e,t,a){return n++,n===i+r?o:e})},a.get_object_id=function(){return o(".xbox").data("object-id")},a.get_object_type=function(){return o(".xbox").data("object-type")},o(function(){a.init()}),a}(window,document,jQuery);